{"version":3,"sources":["../api/services/StackService/getContribution.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,qCAAyC;AAEzC,uEAAyD;AACzD,yCAA4C;AAE5C,SAAe,eAAe,CAAC,KAAe,EAAE,QAAQ,GAAG,IAAI,EAAE,EAAE,WAAW,KAE1E,EAAE;;QACJ,MAAM,UAAU,GAAG,CAAC,OAAO,EAAE,QAAQ,EAAE,WAAW,EAAE,OAAO,CAAC,CAAC;QAC7D,IAAI,QAAQ,EAAE;YACZ,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAC1B,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;SACzB;QAED,MAAM,OAAO,GAAG,MAAM,gBAAM,CAAC,OAAO,CAAC;YACnC,KAAK,EAAE;gBACL,MAAM,EAAE;oBACN,CAAC,cAAE,CAAC,EAAE,CAAC,EAAE,CAAC,aAAa,EAAE,iBAAiB,EAAE,mBAAmB,EAAE,mBAAmB,CAAC;iBACtF;gBACD,MAAM,EAAE,KAAK,CAAC,EAAE;aACjB;YACD,UAAU;YACV,OAAO,EAAE,CAAC;oBACR,KAAK,EAAE,gBAAM;oBACb,EAAE,EAAE,SAAS;oBACb,UAAU,EAAE,aAAa,CAAC,eAAe;iBAC1C,CAAC;YACF,WAAW;SACZ,CAAC,CAAC;QAEH,OAAO,OAAO,CAAC;IACjB,CAAC;CAAA;AAED,kBAAe,eAAe,CAAC","file":"getContribution.js","sourcesContent":["import { Record, Client } from '@Models';\nimport { StackObj } from '@Types';\nimport * as ClientService from '@Services/ClientService';\nimport { Op, Transaction } from 'sequelize';\n\nasync function getContribution(stack: StackObj, withData = true, { transaction }: {\n  transaction?: Transaction;\n} = {}) {\n  const attributes = ['model', 'target', 'operation', 'owner'];\n  if (withData) {\n    attributes.push('before');\n    attributes.push('data');\n  }\n\n  const records = await Record.findAll({\n    where: {\n      action: {\n        [Op.or]: ['createStack', 'invalidateStack', 'updateStackStatus', 'updateStackDetail'],\n      },\n      target: stack.id,\n    },\n    attributes,\n    include: [{\n      model: Client,\n      as: 'ownedBy',\n      attributes: ClientService.sanitizedFields,\n    }],\n    transaction,\n  });\n\n  return records;\n}\n\nexport default getContribution;\n"],"sourceRoot":"../../../../src"}