{"version":3,"sources":["../api/services/TagService/propagateHierarchyChange.ts"],"names":[],"mappings":";;;;;;;;;;;;AAAA,qCAAyC;AACzC,+DAA4D;AAErD,MAAM,wBAAwB,GAAG,CAAO,EAC7C,GAAG,EAAE,WAAW,EAAE,aAAa,EAAE,IAAI,GAKtC,EAAE,EAAE;IACH,MAAM,aAAa,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,EAAE,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,MAAM,IAAA,yCAAmB,EAAC;QACzE,GAAG;QACH,WAAW;KACZ,CAAC,CAAC;IACH,MAAM,aAAG,CAAC,MAAM,CACd,EAAE,aAAa,EAAE,EACjB;QACE,KAAK,EAAE,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE;QACrB,WAAW;KACZ,CACF,CAAC;IACF,MAAM,QAAQ,GAAG,MAAM,aAAG,CAAC,OAAO,CAAC;QACjC,KAAK,EAAE;YACL,QAAQ,EAAE,GAAG,CAAC,EAAE;SACjB;KACF,CAAC,CAAC;IACH,MAAM,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,IAAA,gCAAwB,EAAC;QAC3D,GAAG,EAAE,CAAC;QACN,WAAW;QACX,aAAa;KACd,CAAC,CAAC,CAAC,CAAC;AACP,CAAC,CAAA,CAAC;AA5BW,QAAA,wBAAwB,4BA4BnC;AAEF,kBAAe,gCAAwB,CAAC","file":"propagateHierarchyChange.js","sourcesContent":["import { Tag, Sequelize } from '@Models';\nimport { getTagHierarchyPath } from './getTagHierarchyPath';\n\nexport const propagateHierarchyChange = async ({\n  tag, transaction, hierarchyPath: path,\n}: {\n  tag: Tag;\n  transaction?: Sequelize.Transaction;\n  hierarchyPath?: number[];\n}) => {\n  const hierarchyPath = path ? [...path, tag.id] : await getTagHierarchyPath({\n    tag,\n    transaction,\n  });\n  await Tag.update(\n    { hierarchyPath },\n    {\n      where: { id: tag.id },\n      transaction,\n    },\n  );\n  const children = await Tag.findAll({\n    where: {\n      parentId: tag.id,\n    },\n  });\n  await Promise.all(children.map(t => propagateHierarchyChange({\n    tag: t,\n    transaction,\n    hierarchyPath,\n  })));\n};\n\nexport default propagateHierarchyChange;\n"],"sourceRoot":"../../../../src"}