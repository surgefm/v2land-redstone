{"version":3,"sources":["../api/services/ChatService/sendMessage.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA,iDAA6B;AAC7B,qCAAkD;AAClD,mCAAyD;AAElD,MAAM,WAAW,GAAG,CAAO,IAA2B,EAAE,QAAgB,EAAE,OAAe,EAAE,GAAsB,EAAE,EAAE;IAC1H,IAAI,OAAO,CAAC,IAAI,EAAE,CAAC,MAAM,KAAK,CAAC;QAAE,OAAO;IAExC,MAAM,IAAI,GAAG,MAAM,IAAA,uBAAe,EAAC,IAAgB,EAAE,GAAe,CAAC,CAAC;IACtE,MAAM,MAAM,GAAG,MAAM,IAAA,qBAAa,EAAC,IAAgB,EAAE,GAAe,CAAC,CAAC;IAEtE,MAAM,IAAI,GAAG;QACX,MAAM,EAAE,IAAI,CAAC,EAAE;QACf,QAAQ,EAAE,QAAQ;KACnB,CAAC;IACF,IAAI,UAAU,GAAG,MAAM,oBAAU,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC;IAC3D,IAAI,CAAC,UAAU,EAAE;QACf,UAAU,GAAG,MAAM,oBAAU,CAAC,MAAM,iBAClC,EAAE,EAAE,IAAA,YAAM,GAAE,IACT,IAAI,EACP,CAAC;KACJ;IAED,MAAM,WAAW,GAAG,MAAM,qBAAW,CAAC,MAAM,CAAC;QAC3C,EAAE,EAAE,IAAA,YAAM,GAAE;QACZ,MAAM,EAAE,IAAI,CAAC,EAAE;QACf,QAAQ;QACR,IAAI,EAAE,OAAO;KACd,CAAC,CAAC;IAEH,UAAU,CAAC,SAAS,GAAG,WAAW,CAAC,SAAS,CAAC;IAC7C,MAAM,UAAU,CAAC,IAAI,EAAE,CAAC;IAExB,MAAM,CAAC,IAAI,CAAC,cAAc,EAAE,WAAW,CAAC,GAAG,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;AAChE,CAAC,CAAA,CAAC;AA7BW,QAAA,WAAW,eA6BtB","file":"sendMessage.js","sourcesContent":["import uuidv4 from 'uuid/v4';\nimport { ChatMessage, ChatMember } from '@Models';\nimport { getOrCreateChat, getChatSocket } from './utils';\n\nexport const sendMessage = async (type: 'client' | 'newsroom', authorId: number, message: string, ids: number | number[]) => {\n  if (message.trim().length === 0) return;\n\n  const chat = await getOrCreateChat(type as 'client', ids as number[]);\n  const socket = await getChatSocket(type as 'client', ids as number[]);\n\n  const data = {\n    chatId: chat.id,\n    clientId: authorId,\n  };\n  let chatMember = await ChatMember.findOne({ where: data });\n  if (!chatMember) {\n    chatMember = await ChatMember.create({\n      id: uuidv4(),\n      ...data,\n    });\n  }\n\n  const chatMessage = await ChatMessage.create({\n    id: uuidv4(),\n    chatId: chat.id,\n    authorId,\n    text: message,\n  });\n\n  chatMember.lastSpoke = chatMessage.createdAt;\n  await chatMember.save();\n\n  socket.emit('send message', chatMessage.get({ plain: true }));\n};\n"],"sourceRoot":"../../../../src"}