{"version":3,"sources":["../api/services/ChatService/readMessage.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA,iDAA6B;AAC7B,qCAAkD;AAClD,mCAAwC;AAEjC,MAAM,WAAW,GAAG,CAAO,QAAgB,EAAE,SAAiB,EAAE,EAAE;IACvE,MAAM,OAAO,GAAG,MAAM,qBAAW,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;IACtD,IAAI,CAAC,OAAO;QAAE,OAAO;IAErB,MAAM,IAAI,GAAG;QACX,MAAM,EAAE,OAAO,CAAC,MAAM;QACtB,QAAQ;KACT,CAAC;IAEF,IAAI,UAAU,GAAG,MAAM,oBAAU,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC;IAC3D,IAAI,CAAC,UAAU,EAAE;QACf,UAAU,GAAG,MAAM,oBAAU,CAAC,MAAM,iBAClC,EAAE,EAAE,IAAA,YAAM,GAAE,IACT,IAAI,EACP,CAAC;KACJ;IAED,IAAI,CAAC,UAAU,CAAC,QAAQ,IAAI,UAAU,CAAC,QAAQ,GAAG,OAAO,CAAC,SAAS,EAAE;QACnE,UAAU,CAAC,QAAQ,GAAG,OAAO,CAAC,SAAS,CAAC;QACxC,MAAM,UAAU,CAAC,IAAI,EAAE,CAAC;QAExB,MAAM,MAAM,GAAG,MAAM,IAAA,qBAAa,EAAC,OAAO,CAAC,MAAM,CAAC,CAAC;QACnD,MAAM,CAAC,IAAI,CAAC,aAAa,EAAE,OAAO,CAAC,MAAM,EAAE,QAAQ,EAAE,OAAO,CAAC,SAAS,CAAC,CAAC;KACzE;AACH,CAAC,CAAA,CAAC;AAxBW,QAAA,WAAW,eAwBtB","file":"readMessage.js","sourcesContent":["import uuidv4 from 'uuid/v4';\nimport { ChatMessage, ChatMember } from '@Models';\nimport { getChatSocket } from './utils';\n\nexport const readMessage = async (clientId: number, messageId: string) => {\n  const message = await ChatMessage.findByPk(messageId);\n  if (!message) return;\n\n  const data = {\n    chatId: message.chatId,\n    clientId,\n  };\n\n  let chatMember = await ChatMember.findOne({ where: data });\n  if (!chatMember) {\n    chatMember = await ChatMember.create({\n      id: uuidv4(),\n      ...data,\n    });\n  }\n\n  if (!chatMember.lastRead || chatMember.lastRead < message.createdAt) {\n    chatMember.lastRead = message.createdAt;\n    await chatMember.save();\n\n    const socket = await getChatSocket(message.chatId);\n    socket.emit('client read', message.chatId, clientId, message.createdAt);\n  }\n};\n"],"sourceRoot":"../../../../src"}