{"version":3,"sources":["../api/services/EventService/updateAlgoliaIndex.ts"],"names":[],"mappings":";;;;;;;;;;;AAEA,qCAAqD;AAGrD,oDAAkD;AAClD,sDAA6D;AAE7D,SAAe,kBAAkB,CAAC,EAAE,KAAK,EAAE,OAAO,EAAE,WAAW,EAI9D;;QACC,KAAK,GAAG,MAAM,eAAK,CAAC,OAAO,CAAC;YAC1B,KAAK,EAAE,EAAE,EAAE,EAAE,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,OAAO,EAAE;YACzC,OAAO,EAAE,CAAC;oBACR,KAAK,EAAE,qBAAW;oBAClB,EAAE,EAAE,aAAa;oBACjB,QAAQ,EAAE,KAAK;iBAChB,EAAE;oBACD,KAAK,EAAE,gBAAM;oBACb,EAAE,EAAE,OAAO;oBACX,QAAQ,EAAE,IAAI;iBACf,CAAC;YACF,WAAW;SACZ,CAAC,CAAC;QAEH,IAAI,KAAK,CAAC,MAAM,KAAK,UAAU,EAAE;YAC/B,OAAO,IAAA,4BAAW,EAAC,KAAK,CAAC,EAAE,CAAC,CAAC;SAC9B;QAED,IAAI,KAAK,CAAC,GAAG;YAAE,KAAK,GAAG,KAAK,CAAC,GAAG,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC;QAElD,KAAK,CAAC,KAAK,GAAG,IAAA,8BAAc,EAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QAE1C,OAAO,IAAA,4BAAW,EAAC,KAAK,CAAC,CAAC;IAC5B,CAAC;CAAA;AAED,kBAAe,kBAAkB,CAAC","file":"updateAlgoliaIndex.js","sourcesContent":["import { Transaction } from 'sequelize';\n\nimport { Event, Client, HeaderImage } from '@Models';\nimport { EventObj } from '@Types';\n\nimport { sanitizeClient } from '../ClientService';\nimport { updateEvent, deleteEvent } from '../AlgoliaService';\n\nasync function updateAlgoliaIndex({ event, eventId, transaction }: {\n  event?: EventObj;\n  eventId?: number;\n  transaction?: Transaction;\n}) {\n  event = await Event.findOne({\n    where: { id: event ? event.id : eventId },\n    include: [{\n      model: HeaderImage,\n      as: 'headerImage',\n      required: false,\n    }, {\n      model: Client,\n      as: 'owner',\n      required: true,\n    }],\n    transaction,\n  });\n\n  if (event.status !== 'admitted') {\n    return deleteEvent(event.id);\n  }\n\n  if (event.get) event = event.get({ plain: true });\n\n  event.owner = sanitizeClient(event.owner);\n\n  return updateEvent(event);\n}\n\nexport default updateAlgoliaIndex;\n"],"sourceRoot":"../../../../src"}