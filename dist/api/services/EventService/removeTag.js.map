{"version":3,"sources":["../api/services/EventService/removeTag.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,qCAA0D;AAC1D,mCAAkE;AAClE,uEAAyD;AAEzD,SAA8B,SAAS,CAAC,OAAe,EAAE,KAAa,EAAE,QAAgB;;QACtF,MAAM,KAAK,GAAG,MAAM,eAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;QAC5C,IAAI,CAAC,KAAK,EAAE;YACV,MAAM,IAAI,sBAAa,CAAC,kCAAyB,EAAE,SAAS,CAAC,CAAC;SAC/D;QAED,MAAM,GAAG,GAAG,MAAM,aAAG,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;QACtC,IAAI,CAAC,GAAG,EAAE;YACR,MAAM,IAAI,sBAAa,CAAC,kCAAyB,EAAE,SAAS,CAAC,CAAC;SAC/D;QAED,MAAM,QAAQ,GAAG,MAAM,kBAAQ,CAAC,OAAO,CAAC;YACtC,KAAK,EAAE;gBACL,KAAK,EAAE,GAAG,CAAC,EAAE;gBACb,OAAO,EAAE,KAAK,CAAC,EAAE;aAClB;SACF,CAAC,CAAC;QAEH,IAAI,CAAC,QAAQ,EAAE;YACb,OAAO,IAAI,CAAC;SACb;aAAM;YACL,MAAM,mBAAS,CAAC,WAAW,CAAC,CAAM,WAAW,EAAC,EAAE;gBAC9C,MAAM,aAAa,CAAC,OAAO,CAAC;oBAC1B,IAAI,EAAE,QAAQ;oBACd,KAAK,EAAE,UAAU;oBACjB,MAAM,EAAE,QAAQ,CAAC,EAAE;oBACnB,MAAM,EAAE,oBAAoB;oBAC5B,KAAK,EAAE,QAAQ;iBAChB,EAAE,EAAE,WAAW,EAAE,CAAC,CAAC;gBAEpB,MAAM,QAAQ,CAAC,OAAO,CAAC,EAAE,WAAW,EAAE,CAAC,CAAC;YAC1C,CAAC,CAAA,CAAC,CAAC;YACH,OAAO,QAAQ,CAAC;SACjB;IACH,CAAC;CAAA;AAlCD,4BAkCC","file":"removeTag.js","sourcesContent":["import { Event, EventTag, Tag, sequelize } from '@Models';\nimport { RedstoneError, ResourceNotFoundErrorType } from '@Types';\nimport * as RecordService from '@Services/RecordService';\n\nexport default async function removeTag(eventId: number, tagId: number, clientId: number) {\n  const event = await Event.findByPk(eventId);\n  if (!event) {\n    throw new RedstoneError(ResourceNotFoundErrorType, '无法找到该事件');\n  }\n\n  const tag = await Tag.findByPk(tagId);\n  if (!tag) {\n    throw new RedstoneError(ResourceNotFoundErrorType, '无法找到该话题');\n  }\n\n  const eventTag = await EventTag.findOne({\n    where: {\n      tagId: tag.id,\n      eventId: event.id,\n    },\n  });\n\n  if (!eventTag) {\n    return null;\n  } else {\n    await sequelize.transaction(async transaction => {\n      await RecordService.destroy({\n        data: eventTag,\n        model: 'EventTag',\n        target: eventTag.id,\n        action: 'removeTagFromEvent',\n        owner: clientId,\n      }, { transaction });\n\n      await eventTag.destroy({ transaction });\n    });\n    return eventTag;\n  }\n}\n"],"sourceRoot":"../../../../src"}