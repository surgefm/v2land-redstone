{"version":3,"sources":["../api/services/AccessControlService/TagAccessControl/getTagRoles.ts"],"names":[],"mappings":";;;;;;;;;;;;AAAA,0EAAsG;AAE/F,MAAM,gBAAgB,GAAG,CAAC,KAAa,EAAE,EAAE,CAAC,OAAO,KAAK,EAAE,CAAC;AAArD,QAAA,gBAAgB,oBAAqC;AAE3D,MAAM,mBAAmB,GAAG,CAAC,KAAa,EAAE,EAAE,CAAC,GAAG,IAAA,wBAAgB,EAAC,KAAK,CAAC,YAAY,CAAC;AAAhF,QAAA,mBAAmB,uBAA6D;AACtF,MAAM,qBAAqB,GAAG,CAAC,KAAa,EAAE,EAAE,CAAC,GAAG,IAAA,wBAAgB,EAAC,KAAK,CAAC,cAAc,CAAC;AAApF,QAAA,qBAAqB,yBAA+D;AAEjG,SAAsB,cAAc,CAAC,KAAa,EAAE,WAAW,GAAG,KAAK;;QACrE,MAAM,QAAQ,GAAG,IAAA,wBAAgB,EAAC,KAAK,CAAC,CAAC;QACzC,MAAM,IAAI,GAAG,IAAA,2BAAmB,EAAC,KAAK,CAAC,CAAC;QAExC,MAAM,SAAS,GAAG,MAAM,IAAA,+BAAkB,EAAC,IAAI,EAAE,QAAQ,EAAE,MAAM,CAAC,CAAC;QACnE,IAAI,CAAC,SAAS,IAAI,WAAW,EAAE;YAC7B,MAAM,IAAA,kBAAK,EAAC,IAAI,EAAE,QAAQ,EAAE,MAAM,CAAC,CAAC;SACrC;QACD,OAAO,IAAI,CAAC;IACd,CAAC;CAAA;AATD,wCASC;AAED,SAAsB,gBAAgB,CAAC,KAAa,EAAE,WAAW,GAAG,KAAK;;QACvE,MAAM,QAAQ,GAAG,IAAA,wBAAgB,EAAC,KAAK,CAAC,CAAC;QACzC,MAAM,UAAU,GAAG,IAAA,6BAAqB,EAAC,KAAK,CAAC,CAAC;QAEhD,MAAM,WAAW,GAAG,CAAC,WAAW,EAAE,cAAc,EAAE,WAAW,EAAE,cAAc,CAAC,CAAC;QAC/E,MAAM,SAAS,GAAG,MAAM,IAAA,+BAAkB,EAAC,UAAU,EAAE,QAAQ,EAAE,WAAW,CAAC,CAAC;QAC9E,IAAI,CAAC,SAAS,IAAI,WAAW,EAAE;YAC7B,MAAM,IAAA,kBAAK,EAAC,UAAU,EAAE,QAAQ,EAAE,WAAW,CAAC,CAAC;YAC/C,MAAM,QAAQ,GAAG,MAAM,cAAc,CAAC,KAAK,CAAC,CAAC;YAC7C,MAAM,IAAA,2BAAc,EAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;SAC5C;QACD,OAAO,UAAU,CAAC;IACpB,CAAC;CAAA;AAZD,4CAYC","file":"getTagRoles.js","sourcesContent":["import { allow, areAnyRolesAllowed, addRoleParents } from '@Services/AccessControlService/operations';\n\nexport const getTagResourceId = (tagId: number) => `tag-${tagId}`;\n\nexport const getTagViewRolePlain = (tagId: number) => `${getTagResourceId(tagId)}-view-role`;\nexport const getTagManageRolePlain = (tagId: number) => `${getTagResourceId(tagId)}-manage-role`;\n\nexport async function getTagViewRole(tagId: number, forceUpdate = false) {\n  const resource = getTagResourceId(tagId);\n  const role = getTagViewRolePlain(tagId);\n\n  const isAllowed = await areAnyRolesAllowed(role, resource, 'view');\n  if (!isAllowed || forceUpdate) {\n    await allow(role, resource, 'view');\n  }\n  return role;\n}\n\nexport async function getTagManageRole(tagId: number, forceUpdate = false) {\n  const resource = getTagResourceId(tagId);\n  const manageRole = getTagManageRolePlain(tagId);\n\n  const permissions = ['addViewer', 'removeViewer', 'addEditor', 'removeEditor'];\n  const isAllowed = await areAnyRolesAllowed(manageRole, resource, permissions);\n  if (!isAllowed || forceUpdate) {\n    await allow(manageRole, resource, permissions);\n    const viewRole = await getTagViewRole(tagId);\n    await addRoleParents(manageRole, viewRole);\n  }\n  return manageRole;\n}\n"],"sourceRoot":"../../../../../src"}