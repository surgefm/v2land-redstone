{"version":3,"sources":["../api/hooks/PgSessionInit/index.js"],"names":[],"mappings":"AAAA,MAAM,EAAE,MAAM,EAAE,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;AACjC,MAAM,EAAE,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;AAEzB,MAAM,CAAC,OAAO,GAAG,SAAS,aAAa,CAAC,KAAK;IAC3C,OAAO;QACL,UAAU,EAAE,UAAS,EAAE;YACrB,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,UAAU,EAAE;gBAC3B,MAAM,cAAc,qBAAQ,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,UAAU,CAAE,CAAC,CAAC,kBAAkB;gBACpF,OAAO,cAAc,CAAC,SAAS,CAAC,CAAC;gBACjC,MAAM,OAAO,GAAG,EAAE,CAAC,YAAY,CAAC,uEAAuE,EAAE,MAAM,CAAC,CAAC;gBAEjH,MAAM,MAAM,GAAG,IAAI,MAAM,CAAC,cAAc,CAAC,CAAC;gBAC1C,MAAM,CAAC,OAAO,EAAE,CAAC;gBAEjB,MAAM,CAAC,KAAK,CAAC,OAAO,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,EAAE;oBACjC,IAAI,CAAC,GAAG,EAAE,EAAE,UAAU;wBACpB,OAAO,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC;wBACtC,MAAM,CAAC,GAAG,EAAE,CAAC;qBACd;yBAAM,IAAI,GAAG,CAAC,IAAI,KAAK,OAAO,EAAE;wBAC/B,MAAM,CAAC,GAAG,EAAE,CAAC;wBACb,MAAM,GAAG,CAAC;qBACX;oBAED,EAAE,EAAE,CAAC;gBACP,CAAC,CAAC,CAAC;aACJ;iBAAM;gBACL,EAAE,EAAE,CAAC;aACN;QACH,CAAC;KACF,CAAC;AACJ,CAAC,CAAC","file":"index.js","sourcesContent":["const { Client } = require('pg');\nconst fs = require('fs');\n\nmodule.exports = function PgSessionInit(sails) {\n  return {\n    initialize: function(cb) {\n      if (!process.env.REDIS_HOST) {\n        const postgresConfig = { ...sails.config.datastores.postgresql }; // copy the config\n        delete postgresConfig['adapter'];\n        const content = fs.readFileSync('node_modules/v2land-sails-pg-session/sql/sails-pg-session-support.sql', 'utf8');\n\n        const client = new Client(postgresConfig);\n        client.connect();\n\n        client.query(content, (err, res) => {\n          if (!err) { // success\n            console.log('PgSession init success');\n            client.end();\n          } else if (err.code !== '42P07') {\n            client.end();\n            throw err;\n          }\n\n          cb();\n        });\n      } else {\n        cb();\n      }\n    },\n  };\n};\n"],"sourceRoot":"../../../../src"}