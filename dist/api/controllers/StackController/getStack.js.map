{"version":3,"sources":["../api/controllers/StackController/getStack.ts"],"names":[],"mappings":";;;;;;;;;;;AACA,yCAA+D;AAE/D,SAAe,QAAQ,CAAC,GAAoB,EAAE,GAAqB;;QACjE,MAAM,EAAE,GAAG,CAAC,GAAG,CAAC,MAAM,CAAC,OAAO,CAAC;QAC/B,MAAM,KAAK,GAAG,MAAM,wBAAY,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC;QAC/C,IAAI,KAAK,EAAE;YACT,KAAK,CAAC,YAAY,GAAG,MAAM,wBAAY,CAAC,eAAe,CAAC,EAAE,EAAE,EAAE,EAAE,IAAI,CAAC,CAAC;YACtE,IAAI,KAAK,CAAC,MAAM,KAAK,UAAU,EAAE;gBAC/B,IAAI,GAAG,CAAC,OAAO,CAAC,QAAQ,EAAE;oBACxB,IAAI,MAAM,gCAAoB,CAAC,cAAc,CAAC,GAAG,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE;wBACnE,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC;qBACxC;iBACF;aACF;iBAAM;gBACL,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC;aACxC;SACF;QAED,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;YACnB,OAAO,EAAE,gBAAgB;SAC1B,CAAC,CAAC;IACL,CAAC;CAAA;AAED,kBAAe,QAAQ,CAAC","file":"getStack.js","sourcesContent":["import { RedstoneRequest, RedstoneResponse } from '@Types';\nimport { StackService, AccessControlService } from '@Services';\n\nasync function getStack(req: RedstoneRequest, res: RedstoneResponse) {\n  const id = +req.params.stackId;\n  const stack = await StackService.findStack(id);\n  if (stack) {\n    stack.contribution = await StackService.getContribution({ id }, true);\n    if (stack.status !== 'admitted') {\n      if (req.session.clientId) {\n        if (await AccessControlService.isClientEditor(req.session.clientId)) {\n          return res.status(200).json({ stack });\n        }\n      }\n    } else {\n      return res.status(200).json({ stack });\n    }\n  }\n\n  res.status(404).json({\n    message: '该进展不存在，或尚未通过审核',\n  });\n}\n\nexport default getStack;\n"],"sourceRoot":"../../../../src"}