{"version":3,"sources":["../api/controllers/AuthController/weiboCallback.ts"],"names":[],"mappings":";;;;;;;;;;;AAAA,qCAA+B;AAC/B,uCAAmC;AAGnC,SAAe,aAAa,CAAC,GAAoB,EAAE,GAAqB;;QACtE,IAAI,CAAC,CAAC,GAAG,CAAC,KAAK,IAAI,GAAG,CAAC,KAAK,CAAC,IAAI,IAAI,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE;YACrD,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;gBAC1B,OAAO,EAAE,sBAAsB;aAChC,CAAC,CAAC;SACJ;QAED,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,GAAG,CAAC,KAAK,CAAC;QAClC,MAAM,IAAI,GAAG,MAAM,cAAI,CAAC,QAAQ,CAAC,KAAe,CAAC,CAAC;QAElD,IAAI,CAAC,IAAI,EAAE;YACT,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;gBAC1B,OAAO,EAAE,UAAU;aACpB,CAAC,CAAC;SACJ;QAED,IAAI,IAAI,CAAC,QAAQ,EAAE;YACjB,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAClB,iBAAiB;gBACjB;iCAC2B,IAAI,CAAC,QAAQ,EAAE;gBAC1C,SAAS,IAAI,EAAE;gBACf,WAAW,KAAK,EAAE;gBAClB,aAAa;gBACb;cACQ,CACT,CAAC;SACH;aAAM;YACL,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAClB,iBAAiB;gBACjB;iCAC2B,kBAAO,CAAC,GAAG,sBAAsB;gBAC5D,SAAS,IAAI,EAAE;gBACf,WAAW,KAAK,EAAE;gBAClB,aAAa;gBACb;cACQ,CACT,CAAC;SACH;IACH,CAAC;CAAA;AAED,kBAAe,aAAa,CAAC","file":"weiboCallback.js","sourcesContent":["import { Auth } from '@Models';\nimport { globals } from '@Configs';\nimport { RedstoneRequest, RedstoneResponse } from '@Types';\n\nasync function weiboCallback(req: RedstoneRequest, res: RedstoneResponse) {\n  if (!(req.query && req.query.code && req.query.state)) {\n    return res.status(400).json({\n      message: '请求缺少 code 或 state 参数',\n    });\n  }\n\n  const { code, state } = req.query;\n  const auth = await Auth.findByPk(state as string);\n\n  if (!auth) {\n    return res.status(404).json({\n      message: '未找到该绑定信息',\n    });\n  }\n\n  if (auth.redirect) {\n    res.status(200).send(\n      `<!DOCTYPE html>` +\n      `<body>\n      <script>window.location=\"${auth.redirect}` +\n      `&code=${code}` +\n      `&authId=${state}` +\n      `&site=weibo` +\n      `\"</script>\n      </body>`\n    );\n  } else {\n    res.status(200).send(\n      `<!DOCTYPE html>` +\n      `<body>\n      <script>window.location=\"${globals.api}/auth/weibo/redirect` +\n      `?code=${code}` +\n      `&authId=${state}` +\n      `&site=weibo` +\n      `\"</script>\n      </body>`\n    );\n  }\n}\n\nexport default weiboCallback;\n"],"sourceRoot":"../../../../src"}