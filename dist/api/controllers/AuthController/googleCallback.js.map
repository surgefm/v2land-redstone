{"version":3,"sources":["../api/controllers/AuthController/googleCallback.ts"],"names":[],"mappings":";;;;;;;;;;;AAAA,qCAA+B;AAC/B,uCAAmC;AAGnC,SAAe,cAAc,CAAC,GAAoB,EAAE,GAAqB;;QACvE,IAAI,CAAC,CAAC,GAAG,CAAC,KAAK,IAAI,GAAG,CAAC,KAAK,CAAC,IAAI,IAAI,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE;YACrD,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;gBAC1B,OAAO,EAAE,sBAAsB;aAChC,CAAC,CAAC;SACJ;QAED,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,GAAG,CAAC,KAAK,CAAC;QAClC,MAAM,IAAI,GAAG,MAAM,cAAI,CAAC,QAAQ,CAAC,KAAe,CAAC,CAAC;QAElD,IAAI,CAAC,IAAI,EAAE;YACT,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;gBAC1B,OAAO,EAAE,UAAU;aACpB,CAAC,CAAC;SACJ;QAED,IAAI,IAAI,CAAC,QAAQ,EAAE;YACjB,GAAG,CAAC,QAAQ,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,QAAQ,SAAS,IAAI,WAAW,KAAK,cAAc,CAAC,CAAC;SAChF;aAAM;YACL,GAAG,CAAC,QAAQ,CAAC,GAAG,EAAE,GAAG,kBAAO,CAAC,GAAG,8BAA8B,IAAI,WAAW,KAAK,EAAE,CAAC,CAAC;SACvF;IACH,CAAC;CAAA;AAED,kBAAe,cAAc,CAAC","file":"googleCallback.js","sourcesContent":["import { Auth } from '@Models';\nimport { globals } from '@Configs';\nimport { RedstoneRequest, RedstoneResponse } from '@Types';\n\nasync function googleCallback(req: RedstoneRequest, res: RedstoneResponse) {\n  if (!(req.query && req.query.code && req.query.state)) {\n    return res.status(400).json({\n      message: '请求缺少 code 或 state 参数',\n    });\n  }\n\n  const { code, state } = req.query;\n  const auth = await Auth.findByPk(state as string);\n\n  if (!auth) {\n    return res.status(404).json({\n      message: '未找到该绑定信息',\n    });\n  }\n\n  if (auth.redirect) {\n    res.redirect(302, `${auth.redirect}&code=${code}&authId=${state}&site=google`);\n  } else {\n    res.redirect(302, `${globals.api}/auth/google/redirect?code=${code}&authId=${state}`);\n  }\n}\n\nexport default googleCallback;\n"],"sourceRoot":"../../../../src"}