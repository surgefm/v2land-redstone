{"version":3,"sources":["../api/controllers/AuthController/google.ts"],"names":[],"mappings":";;;;;;;;;;;AAAA,iDAAiD;AACjD,qCAA+B;AAC/B,uCAA0C;AAG1C,MAAM,MAAM,GAAG;IACb,gDAAgD;IAChD,kDAAkD;CACnD,CAAC;AAEF,SAAe,MAAM,CAAC,GAAoB,EAAE,GAAqB;;QAC/D,MAAM,EAAE,GAAG,gBAAK,CAAC,MAAM,CAAC;QAExB,IAAI,CAAC,EAAE,EAAE;YACP,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;gBAC1B,OAAO,EAAE,gBAAgB;aAC1B,CAAC,CAAC;SACJ;QAED,MAAM,IAAI,GAAG,MAAM,cAAI,CAAC,MAAM,CAAC;YAC7B,IAAI,EAAE,QAAQ;YACd,KAAK,EAAE,GAAG,CAAC,OAAO,CAAC,QAAQ;YAC3B,QAAQ,EAAE,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE;YAC7C,UAAU,EAAE,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,EAAE;SAClD,CAAC,CAAC;QAEH,MAAM,QAAQ,GAAG,kBAAO,CAAC,GAAG,GAAG,uBAAuB,CAAC;QAEvD,GAAG,CAAC,QAAQ,CAAC,GAAG,EAAE,EAAE,CAAC,eAAe,CAAC;YACnC,WAAW,EAAE,SAAS;YACtB,YAAY,EAAE,QAAQ;YACtB,KAAK,EAAE,IAAI,CAAC,EAAE;YACd,sBAAsB,EAAE,IAAI;YAC5B,KAAK,EAAE,MAAM;SACd,CAAC,CAAC,CAAC;IACN,CAAC;CAAA;AAED,kBAAe,MAAM,CAAC","file":"google.js","sourcesContent":["/* eslint-disable @typescript-eslint/camelcase */\nimport { Auth } from '@Models';\nimport { oauth, globals } from '@Configs';\nimport { RedstoneRequest, RedstoneResponse } from '@Types';\n\nconst scopes = [\n  'https://www.googleapis.com/auth/userinfo.email',\n  'https://www.googleapis.com/auth/userinfo.profile',\n];\n\nasync function google(req: RedstoneRequest, res: RedstoneResponse) {\n  const oa = oauth.google;\n\n  if (!oa) {\n    return res.status(503).json({\n      message: '暂不支持 Google 绑定',\n    });\n  }\n\n  const auth = await Auth.create({\n    site: 'google',\n    owner: req.session.clientId,\n    redirect: req.query ? req.query.redirect : '',\n    inviteCode: req.query ? req.query.inviteCode : '',\n  });\n\n  const callback = globals.api + '/auth/google/callback';\n\n  res.redirect(307, oa.generateAuthUrl({\n    access_type: 'offline',\n    redirect_uri: callback,\n    state: auth.id,\n    include_granted_scopes: true,\n    scope: scopes,\n  }));\n}\n\nexport default google;\n"],"sourceRoot":"../../../../src"}