{"version":3,"sources":["../api/controllers/AuthController/twitterCallback.ts"],"names":[],"mappings":";;;;;;;;;;;AAAA,qCAA+B;AAG/B,SAAe,eAAe,CAAC,GAAoB,EAAE,GAAqB;;QACxE,IAAI,CAAC,CAAC,GAAG,CAAC,KAAK,IAAI,GAAG,CAAC,KAAK,CAAC,WAAW,IAAI,GAAG,CAAC,KAAK,CAAC,cAAc,CAAC,EAAE;YACrE,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;gBAC1B,OAAO,EAAE,uBAAuB;aACjC,CAAC,CAAC;SACJ;QAED,MAAM,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC,WAAW,CAAC;QACpC,MAAM,QAAQ,GAAG,GAAG,CAAC,KAAK,CAAC,cAAc,CAAC;QAE1C,MAAM,IAAI,GAAG,MAAM,cAAI,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,EAAE,KAAK,EAAE,EAAE,CAAC,CAAC;QACtD,IAAI,CAAC,IAAI,EAAE;YACT,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;gBAC1B,OAAO,EAAE,UAAU;aACpB,CAAC,CAAC;SACJ;QAED,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAClB,iBAAiB;YACjB;+BAC2B,IAAI,CAAC,QAAQ,IAAI,yBAAyB,EAAE;YACvE,UAAU,KAAK,EAAE;YACjB,aAAa,QAAQ,EAAE;YACvB;YACQ,CACT,CAAC;IACJ,CAAC;CAAA;AAED,kBAAe,eAAe,CAAC","file":"twitterCallback.js","sourcesContent":["import { Auth } from '@Models';\nimport { RedstoneRequest, RedstoneResponse } from '@Types';\n\nasync function twitterCallback(req: RedstoneRequest, res: RedstoneResponse) {\n  if (!(req.query && req.query.oauth_token && req.query.oauth_verifier)) {\n    return res.status(400).json({\n      message: '请求缺少 token 或 verifier',\n    });\n  }\n\n  const token = req.query.oauth_token;\n  const verifier = req.query.oauth_verifier;\n\n  const auth = await Auth.findOne({ where: { token } });\n  if (!auth) {\n    return res.status(404).json({\n      message: '未找到该绑定信息',\n    });\n  }\n\n  res.status(200).send(\n    `<!DOCTYPE html>` +\n    `<body>\n    <script>window.location=\"${auth.redirect || '/auth/twitter/redirect?'}` +\n    `&token=${token}` +\n    `&verifier=${verifier}` +\n    `&site=twitter\"</script>\n    </body>`\n  );\n}\n\nexport default twitterCallback;\n"],"sourceRoot":"../../../../src"}