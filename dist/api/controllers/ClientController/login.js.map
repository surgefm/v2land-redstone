{"version":3,"sources":["../api/controllers/ClientController/login.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,+CAAiC;AAEjC,yCAA0C;AAE1C,SAAe,KAAK,CAAC,GAAoB,EAAE,GAAqB;;QAC9D,MAAM,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC;QAEtB,MAAM,MAAM,GAAG,MAAM,yBAAa,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,EAAE;YAC3D,SAAS,EAAE,KAAK;YAChB,iBAAiB,EAAE,KAAK;YACxB,YAAY,EAAE,IAAI;SACnB,CAAC,CAAC;QAEH,IAAI,CAAC,MAAM,EAAE;YACX,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;gBAC1B,OAAO,EAAE,QAAQ;aAClB,CAAC,CAAC;SACJ;QAED,MAAM,QAAQ,GAAG,MAAM,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC;QAEtE,IAAI,CAAC,QAAQ,EAAE;YACb,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;gBAC1B,OAAO,EAAE,cAAc;aACxB,CAAC,CAAC;SACJ;QAED,GAAG,CAAC,OAAO,CAAC,QAAQ,GAAG,MAAM,CAAC,EAAE,CAAC;QACjC,MAAM,SAAS,GAAQ,MAAM,CAAC,GAAG,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC;QACnD,OAAO,SAAS,CAAC,QAAQ,CAAC;QAE1B,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;YACnB,OAAO,EAAE,MAAM;YACf,MAAM,EAAE,SAAS;SAClB,CAAC,CAAC;IACL,CAAC;CAAA;AAED,kBAAe,KAAK,CAAC","file":"login.js","sourcesContent":["import * as bcrypt from 'bcrypt';\nimport { RedstoneRequest, RedstoneResponse } from '@Types';\nimport { ClientService } from '@Services';\n\nasync function login(req: RedstoneRequest, res: RedstoneResponse) {\n  const data = req.body;\n\n  const client = await ClientService.findClient(data.username, {\n    withAuths: false,\n    withSubscriptions: false,\n    withPassword: true,\n  });\n\n  if (!client) {\n    return res.status(404).json({\n      message: '未找到该用户',\n    });\n  }\n\n  const verified = await bcrypt.compare(data.password, client.password);\n\n  if (!verified) {\n    return res.status(401).json({\n      message: '错误的用户名、邮箱或密码',\n    });\n  }\n\n  req.session.clientId = client.id;\n  const clientObj: any = client.get({ plain: true });\n  delete clientObj.password;\n\n  res.status(200).json({\n    message: '登录成功',\n    client: clientObj,\n  });\n}\n\nexport default login;\n"],"sourceRoot":"../../../../src"}