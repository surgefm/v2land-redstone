{"version":3,"sources":["../api/controllers/UploadController.ts"],"names":[],"mappings":";;;;;;;;;;;;AACA,yCAAwC;AACxC,2DAA6C;AAE7C,SAAsB,MAAM,CAAC,GAAoB,EAAE,GAAqB;;QACtE,MAAM,EAAE,MAAM,EAAE,SAAS,EAAE,GAAG,OAAO,CAAC,GAAG,CAAC;QAC1C,IAAI,CAAC,CAAC,MAAM,IAAI,SAAS,CAAC,EAAE;YAC1B,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;gBAC1B,OAAO,EAAE,wDAAwD;aAClE,CAAC,CAAC;SACJ;QAED,MAAM,QAAQ,GAAG,uBAAW,CAAC,gBAAgB,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QACxD,OAAO,IAAI,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE;YACrC,kBAAE,CAAC,MAAM,CAAC;gBACR,MAAM,EAAE,SAAS;gBACjB,GAAG,EAAE,QAAQ;gBACb,IAAI,EAAE,GAAG,CAAC,IAAI,CAAC,MAAM;gBACrB,GAAG,EAAE,aAAa;gBAClB,YAAY,EAAE,qBAAqB;aACpC,EAAE,CAAO,GAAG,EAAE,EAAE;gBACf,IAAI,GAAG;oBAAE,OAAO,MAAM,CAAC,GAAG,CAAC,CAAC;gBAC5B,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;oBAC3B,OAAO,EAAE,MAAM;oBACf,IAAI,EAAE,QAAQ;iBACf,CAAC,CAAC,CAAC;YACN,CAAC,CAAA,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC;CAAA;AAxBD,wBAwBC","file":"UploadController.js","sourcesContent":["import { RedstoneRequest, RedstoneResponse } from '@Types';\nimport { UtilService } from '@Services';\nimport { s3 } from '@Services/UploadService';\n\nexport async function upload(req: RedstoneRequest, res: RedstoneResponse) {\n  const { S3_KEY, S3_BUCKET } = process.env;\n  if (!(S3_KEY && S3_BUCKET)) {\n    return res.status(503).json({\n      message: '暂不支持文件上传。如需开启该功能请联系管理员配置环境变量 S3_ID、S3_KEY 与 S3_BUCKET。',\n    });\n  }\n\n  const filename = UtilService.generateFilename(req.file);\n  return new Promise((resolve, reject) => {\n    s3.upload({\n      Bucket: S3_BUCKET,\n      Key: filename,\n      Body: req.file.buffer,\n      ACL: 'public-read',\n      StorageClass: 'INTELLIGENT_TIERING',\n    }, async (err) => {\n      if (err) return reject(err);\n      resolve(res.status(201).json({\n        message: '上传成功',\n        name: filename,\n      }));\n    });\n  });\n}\n"],"sourceRoot":"../../../src"}