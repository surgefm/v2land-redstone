{"version":3,"sources":["../api/controllers/UploadController.ts"],"names":[],"mappings":";;;;;;;;;;;;AAAA,kDAAsD;AAGtD,yCAAwC;AACxC,2DAA6C;AAE7C,SAAsB,MAAM,CAAC,GAAoB,EAAE,GAAqB;;QACtE,MAAM,EAAE,MAAM,EAAE,SAAS,EAAE,GAAG,OAAO,CAAC,GAAG,CAAC;QAC1C,IAAI,CAAC,CAAC,MAAM,IAAI,SAAS,CAAC,EAAE;YAC1B,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;gBAC1B,OAAO,EAAE,wDAAwD;aAClE,CAAC,CAAC;SACJ;QAED,MAAM,QAAQ,GAAG,uBAAW,CAAC,gBAAgB,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QACxD,MAAM,kBAAE,CAAC,IAAI,CACT,IAAI,4BAAgB,CAAC;YACrB,MAAM,EAAE,SAAS;YACjB,GAAG,EAAE,QAAQ;YACb,IAAI,EAAE,GAAG,CAAC,IAAI,CAAC,MAAM;YACrB,GAAG,EAAE,aAAa;YAClB,YAAY,EAAE,qBAAqB;SACpC,CAAC,CACH,CAAC;QACF,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;YACnB,OAAO,EAAE,MAAM;YACf,IAAI,EAAE,QAAQ;SACf,CAAC,CAAC;IACL,CAAC;CAAA;AAtBD,wBAsBC","file":"UploadController.js","sourcesContent":["import { PutObjectCommand } from '@aws-sdk/client-s3';\n\nimport { RedstoneRequest, RedstoneResponse } from '@Types';\nimport { UtilService } from '@Services';\nimport { s3 } from '@Services/UploadService';\n\nexport async function upload(req: RedstoneRequest, res: RedstoneResponse) {\n  const { S3_KEY, S3_BUCKET } = process.env;\n  if (!(S3_KEY && S3_BUCKET)) {\n    return res.status(503).json({\n      message: '暂不支持文件上传。如需开启该功能请联系管理员配置环境变量 S3_ID、S3_KEY 与 S3_BUCKET。',\n    });\n  }\n\n  const filename = UtilService.generateFilename(req.file);\n  await s3.send(\n      new PutObjectCommand({\n      Bucket: S3_BUCKET,\n      Key: filename,\n      Body: req.file.buffer,\n      ACL: 'public-read',\n      StorageClass: 'INTELLIGENT_TIERING',\n    })\n  );\n  res.status(201).json({\n    message: '上传成功',\n    name: filename,\n  });\n}\n"],"sourceRoot":"../../../src"}