{"version":3,"sources":["../api/controllers/OAuth2Controller/implicitGrant.ts"],"names":[],"mappings":";;;;;;;;;;;;;;AACA,qCAA8C;AAC9C,yCAA0C;AAC1C,sEAA8C;AAE9C,SAAe,aAAa,CAAC,GAAoB,EAAE,GAAqB;;QACtE,MAAM,IAAA,oBAAU,EAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,QAAQ,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC,CAAC;IACvD,CAAC;CAAA;AAED,SAAe,QAAQ,CAAC,GAAoB,EAAE,GAAqB;;QACjE,MAAM,qBAAqB,GAAG,GAAG,CAAC,KAAK,CAAC,qBAAqB,CAAC;QAC9D,MAAM,QAAQ,GAAG,GAAG,CAAC,OAAO,CAAC,QAAQ,CAAC;QAEtC,MAAM,mBAAmB,GAAG,MAAM,6BAAmB,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,EAAE,qBAAqB,EAAE,EAAE,CAAC,CAAC;QACxG,IAAI,mBAAmB,IAAI,IAAI,EAAE;YAC/B,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;gBAC1B,OAAO,EAAE,SAAS;aACnB,CAAC,CAAC;SACJ;QAED,MAAM,WAAW,GAAG,MAAM,yBAAa,CAAC,iBAAiB,CAAC,QAAQ,EAAE,QAAQ,CAAC,qBAA+B,CAAC,EAAE,IAAI,CAAC,CAAC;QACrH,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;YAC1B,OAAO,EAAE,MAAM;YACf,WAAW;SACZ,CAAC,CAAC;IACL,CAAC;CAAA;AAED,kBAAe,aAAa,CAAC","file":"implicitGrant.js","sourcesContent":["import { RedstoneRequest, RedstoneResponse } from '@Types';\nimport { AuthorizationClient } from '@Models';\nimport { OAuth2Service } from '@Services';\nimport isLoggedIn from '@Policies/isLoggedIn';\n\nasync function implicitGrant(req: RedstoneRequest, res: RedstoneResponse) {\n  await isLoggedIn(req, res, () => granting(req, res));\n}\n\nasync function granting(req: RedstoneRequest, res: RedstoneResponse) {\n  const authorizationClientId = req.query.authorizationClientId;\n  const clientId = req.session.clientId;\n\n  const authorizationClient = await AuthorizationClient.findOne({ where: { id: authorizationClientId } });\n  if (authorizationClient == null) {\n    return res.status(404).json({\n      message: '未找到该客户端',\n    });\n  }\n\n  const accessToken = await OAuth2Service.getNewAccessToken(clientId, parseInt(authorizationClientId as string), true);\n  return res.status(201).json({\n    message: '操作成功',\n    accessToken,\n  });\n}\n\nexport default implicitGrant;\n"],"sourceRoot":"../../../../src"}