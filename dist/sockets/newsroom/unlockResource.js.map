{"version":3,"sources":["../sockets/newsroom/unlockResource.ts"],"names":[],"mappings":";;;;;;;;;;;;;;AACA,yCAAsE;AAEtE,gEAAwC;AAExC,SAAwB,cAAc,CAAC,MAAc;IACnD,MAAM,CAAC,EAAE,CAAC,iBAAiB,EAAE,CAAO,OAAe,EAAE,KAAa,EAAE,UAAkB,EAAE,KAAe,GAAG,EAAE,GAAE,CAAC,EAAE,EAAE;QACjH,MAAM,EAAE,QAAQ,EAAE,GAAG,MAAM,CAAC,SAAS,CAAC,OAAO,CAAC;QAC9C,MAAM,UAAU,GAAG,MAAM,gCAAoB,CAAC,oBAAoB,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;QACtF,IAAI,CAAC,UAAU;YAAE,OAAO,EAAE,CAAC,yCAAyC,CAAC,CAAC;QAEtE,MAAM,QAAQ,GAAG,MAAM,+BAAmB,CAAC,MAAM,CAAC,KAAK,EAAE,UAAU,EAAE,QAAQ,EAAE,OAAO,CAAC,CAAC;QACxF,IAAI,CAAC,QAAQ,EAAE;YACb,OAAO,EAAE,CAAC,iCAAiC,CAAC,CAAC;SAC9C;QAED,MAAM,CAAC,EAAE,CAAC,IAAA,qBAAW,EAAC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,iBAAiB,EAAE;YACtD,OAAO;YACP,KAAK;YACL,UAAU;YACV,MAAM,EAAE,QAAQ;SACjB,CAAC,CAAC;QACH,EAAE,EAAE,CAAC;IACP,CAAC,CAAA,CAAC,CAAC;AACL,CAAC;AAnBD,iCAmBC","file":"unlockResource.js","sourcesContent":["import { Socket } from 'socket.io';\nimport { ResourceLockService, AccessControlService } from '@Services';\n\nimport getRoomName from './getRoomName';\n\nexport default function unlockResource(socket: Socket) {\n  socket.on('unlock resource', async (eventId: number, model: string, resourceId: number, cb: Function = () => {}) => {\n    const { clientId } = socket.handshake.session;\n    const haveAccess = await AccessControlService.isAllowedToEditEvent(clientId, eventId);\n    if (!haveAccess) return cb('You are not allowed to edit this event.');\n\n    const unlocked = await ResourceLockService.unlock(model, resourceId, clientId, eventId);\n    if (!unlocked) {\n      return cb('You canâ€™t unlock this resource.');\n    }\n\n    socket.in(getRoomName(eventId)).emit('unlock resource', {\n      eventId,\n      model,\n      resourceId,\n      locker: clientId,\n    });\n    cb();\n  });\n}\n"],"sourceRoot":"../../../src"}