{"version":3,"sources":["../sockets/newsroom/removeClientFromNewsroom.ts"],"names":[],"mappings":";;;;;;;;;;;;;;AACA,yCAAyC;AACzC,gEAAwC;AACxC,kEAA0C;AAE1C,SAAe,wBAAwB,CAAC,MAAc,EAAE,OAAe,EAAE,QAAgB;;QACvF,MAAM,GAAG,GAAG,iBAAiB,QAAQ,IAAI,OAAO,EAAE,CAAC;QACnD,MAAM,GAAG,GAAG,MAAM,wBAAY,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;QAC5C,MAAM,SAAS,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACnC,MAAM,IAAI,GAAG,IAAA,qBAAW,EAAC,OAAO,CAAC,CAAC;QAElC,MAAM,CAAC,EAAE,CAAC,sBAAY,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,gBAAgB,EAAE,EAAE,OAAO,EAAE,QAAQ,EAAE,CAAC,CAAC;QAE/E,KAAK,MAAM,EAAE,IAAI,SAAS,EAAE;YAC1B,MAAM,CAAC,GAAG,MAAM,CAAC,EAAE,CAAC,sBAAY,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;YAClD,IAAI,CAAC,EAAE;gBACL,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;aACf;YACD,MAAM,wBAAY,CAAC,IAAI,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;SAClC;IACH,CAAC;CAAA;AAED,kBAAe,wBAAwB,CAAC","file":"removeClientFromNewsroom.js","sourcesContent":["import { Server } from 'socket.io';\nimport { RedisService } from '@Services';\nimport getRoomName from './getRoomName';\nimport newsroomPath from './newsroomPath';\n\nasync function removeClientFromNewsroom(server: Server, eventId: number, clientId: number) {\n  const key = `socket:client-${clientId}-${eventId}`;\n  const obj = await RedisService.hgetall(key);\n  const socketIds = Object.keys(obj);\n  const room = getRoomName(eventId);\n\n  server.of(newsroomPath).in(room).emit('leave newsroom', { eventId, clientId });\n\n  for (const id of socketIds) {\n    const s = server.of(newsroomPath).sockets.get(id);\n    if (s) {\n      s.leave(room);\n    }\n    await RedisService.hdel(key, id);\n  }\n}\n\nexport default removeClientFromNewsroom;\n"],"sourceRoot":"../../../src"}