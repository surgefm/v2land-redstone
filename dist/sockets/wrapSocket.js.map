{"version":3,"sources":["../sockets/wrapSocket.ts"],"names":[],"mappings":";;;;;;;;;;;AAEA;;;;;GAKG;AACH,SAAwB,UAAU,CAAC,MAAc;IAC/C,MAAM,UAAU,GAAG,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IAE1C,MAAM,CAAC,EAAE,GAAG,UAAS,KAAa,EAAE,OAAgC;QAClE,OAAO,UAAU,CAAC,KAAK,EAAE,CAAO,GAAG,IAAW,EAAE,EAAE;YAChD,IAAI;gBACF,MAAM,OAAO,CAAC,GAAG,IAAI,CAAC,CAAC;aACxB;YAAC,OAAO,GAAG,EAAE;gBACZ,OAAO,CAAC,KAAK,CAAC,8BAA8B,KAAK,IAAI,EAAE,GAAG,CAAC,CAAC;gBAC5D,uDAAuD;gBACvD,MAAM,EAAE,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;gBACjC,IAAI,OAAO,EAAE,KAAK,UAAU,EAAE;oBAC5B,EAAE,CAAC,GAAG,YAAY,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC;iBACtD;aACF;QACH,CAAC,CAAA,CAAC,CAAC;IACL,CAAQ,CAAC;IAET,OAAO,MAAM,CAAC;AAChB,CAAC;AAnBD,6BAmBC","file":"wrapSocket.js","sourcesContent":["import { Socket } from 'socket.io';\n\n/**\n * Wraps a Socket so that any async event handler registered via `.on()`\n * automatically catches rejected promises and forwards the error message\n * to the callback (the last argument), preventing unhandled rejections\n * from crashing the process.\n */\nexport default function wrapSocket(socket: Socket): Socket {\n  const originalOn = socket.on.bind(socket);\n\n  socket.on = function(event: string, handler: (...args: any[]) => any) {\n    return originalOn(event, async (...args: any[]) => {\n      try {\n        await handler(...args);\n      } catch (err) {\n        console.error(`[Socket] Error in handler \"${event}\":`, err);\n        // Convention: the last argument is a callback function\n        const cb = args[args.length - 1];\n        if (typeof cb === 'function') {\n          cb(err instanceof Error ? err.message : String(err));\n        }\n      }\n    });\n  } as any;\n\n  return socket;\n}\n"],"sourceRoot":"../../src"}