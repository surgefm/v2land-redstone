{"version":3,"sources":["../models/Client.ts"],"names":[],"mappings":"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","file":"Client.js","sourcesContent":["import {\n  Table,\n  Column,\n  Model,\n  DataType,\n  TableOptions,\n  AllowNull,\n  Is,\n  Unique,\n  Default,\n  HasMany,\n  BelongsToMany,\n} from 'sequelize-typescript';\nimport _ from 'lodash';\n\nimport Record from './Record';\nimport Auth from './Auth';\nimport Subscription from './Subscription';\nimport Contact from './Contact';\nimport Report from './Report';\nimport AuthorizationCode from './AuthorizationCode';\nimport AuthorizationAccessToken from './AuthorizationAccessToken';\nimport Tag from './Tag';\nimport TagCurator from './TagCurator';\nimport Event from './Event';\nimport Star from './Star';\n\n@Table({\n  modelName: 'client',\n  freezeTableName: true,\n} as TableOptions)\nclass Client extends Model<Client> {\n  @Is('Username', (value) => {\n    if (!_.isString(value) || value.length < 2 || value.length > 16) {\n      throw new Error('用户名长度应在 2-16 个字符内');\n    }\n\n    if (/[^a-zA-Z0-9]/.test(value)) {\n      throw new Error('用户名不得含有除 a-z，A-Z，0-9 外的字符');\n    }\n\n    if (/^\\d+$/.test(value)) {\n      throw new Error('用户名不得全为数字');\n    }\n\n    const unavailableUsernameSet: Set<string> = new Set<string>(['event', 'topic', 'register',\n      'login', 'logout', 'about', 'dashboard', 'trending', 'topics', 'settings', 'signup']);\n    if (unavailableUsernameSet.has(value)) {\n      throw new Error('用户名不可用');\n    }\n  })\n  @AllowNull(false)\n  @Unique(true)\n  @Column(DataType.TEXT)\n  username: string;\n\n  @Is('Nickname', (value) => {\n    if (!_.isString(value) || value.length < 2 || value.length > 16) {\n      throw new Error('昵称长度应在 2-16 个字符内');\n    } else if (/\\r?\\n|\\r|@|%/.test(value)) {\n      throw new Error('昵称不得含有 @ 或 %。');\n    }\n\n    let allDigit = true;\n    for (const char of value) {\n      if (!/\\d/.test(char)) {\n        allDigit = false;\n        break;\n      }\n    }\n    if (allDigit) {\n      throw new Error('昵称不得全为数字');\n    }\n  })\n  @AllowNull(false)\n  @Unique(false)\n  @Column(DataType.TEXT)\n  nickname: string;\n\n  @AllowNull(true)\n  @Column(DataType.TEXT)\n  description: string;\n\n  @AllowNull(false)\n  @Column(DataType.TEXT)\n  email: string;\n\n  @AllowNull(false)\n  @Column(DataType.TEXT)\n  password: string;\n\n  @AllowNull(false)\n  @Default('contributor')\n  @Column(DataType.ENUM('admin', 'manager', 'contributor', 'editor'))\n  role: string;\n\n  @AllowNull(true)\n  @Column(DataType.TEXT)\n  avatar: string;\n\n  @AllowNull(false)\n  @Default(false)\n  @Column(DataType.BOOLEAN)\n  emailVerified: boolean;\n\n  @AllowNull(false)\n  @Default({})\n  @Column(DataType.JSONB)\n  settings: any;\n\n  @HasMany(() => Record, 'owner')\n  records: Record[];\n\n  @HasMany(() => Auth, 'owner')\n  auths: Auth[];\n\n  @HasMany(() => Subscription, 'subscriber')\n  subscriptions: Subscription[];\n\n  @HasMany(() => Contact, 'owner')\n  contacts: Contact[];\n\n  @HasMany(() => Report, 'owner')\n  reports: Report[];\n\n  @HasMany(() => AuthorizationCode, 'owner')\n  authorizationCodes: AuthorizationCode[];\n\n  @HasMany(() => AuthorizationAccessToken, 'owner')\n  authorizationAccessTokens: AuthorizationAccessToken[];\n\n  @HasMany(() => Star, 'clientId')\n  stars: Star[];\n\n  @BelongsToMany(() => Tag, () => TagCurator)\n  tags: Array<Tag & {tagCurator: TagCurator}>;\n\n  @HasMany(() => Event, 'ownerId')\n  events: Event[];\n\n  curatorRoles?: TagCurator[];\n\n  subscriptionCount?: number;\n  isAdmin?: boolean;\n  isManager?: boolean;\n  isEditor?: boolean;\n}\n\nexport default Client;\n"],"sourceRoot":"../../src"}