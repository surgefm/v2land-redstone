{"version":3,"sources":["../notifications/notifyByMobileAppNotification.ts"],"names":[],"mappings":";;;;;;;;;;;;;;AAIA,yCAA0D;AAC1D,gDAAwB;AACxB,MAAM,MAAM,GAAG,IAAA,cAAI,GAAE,CAAC;AAEtB,SAAe,6BAA6B,CAAC,EAAE,OAAO,EAAE,YAAY,EAAE,QAAQ,EAI7E;;QACC,IAAI,CAAC,OAAO,EAAE;YACZ,YAAY,CAAC,MAAM,GAAG,QAAQ,CAAC;YAC/B,MAAM,YAAY,CAAC,IAAI,EAAE,CAAC;YAC1B,OAAO,MAAM,CAAC,KAAK,CAAC,IAAI,KAAK,CAAC,SAAS,YAAY,CAAC,UAAU,WAAW,CAAC,CAAC,CAAC;SAC7E;QAED,MAAM,OAAO,GAAG,uBAAW,CAAC,aAAa,CAAC,QAAQ,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC;QACjE,OAAO,4BAAgB,CAAC,gBAAgB,CAAC,OAAO,CAAC,SAAS,EAAE;YAC1D,KAAK,EAAE;gBACL,OAAO,EAAE,aAAa;gBACtB,MAAM,EAAE,OAAO;gBACf,mBAAmB,EAAE,CAAC;gBACtB,WAAW,EAAE,YAAY,CAAC,OAAO;aAClC;YACD,KAAK,EAAE,WAAW;YAClB,OAAO,EAAE,YAAY,CAAC,OAAO;SAC9B,CAAC,CAAC;IACL,CAAC;CAAA;AAED,kBAAe,6BAA6B,CAAC","file":"notifyByMobileAppNotification.js","sourcesContent":["/**\n * 向用户的移动设备发布推送\n */\nimport { Contact, Subscription } from '@Models';\nimport { LeanCloudService, UtilService } from '@Services';\nimport pino from 'pino';\nconst logger = pino();\n\nasync function notifyByMobileAppNotification({ contact, subscription, template }: {\n  contact: Contact;\n  subscription: Subscription;\n  template: any;\n}) {\n  if (!contact) {\n    subscription.status = 'failed';\n    await subscription.save();\n    return logger.error(new Error(`未找到用户 ${subscription.subscriber} 的 App 绑定`));\n  }\n\n  const message = UtilService.shortenString(template.message, 100);\n  return LeanCloudService.pushNotification(contact.profileId, {\n    alert: {\n      'title': '你关注的事件有了新动态',\n      'body': message,\n      'content-available': 1,\n      'thread-id': subscription.eventId,\n    },\n    badge: 'Increment',\n    eventId: subscription.eventId,\n  });\n}\n\nexport default notifyByMobileAppNotification;\n"],"sourceRoot":"../../src"}